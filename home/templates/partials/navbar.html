<!-- Navigation -->
<nav class="navbar navbar-expand-lg navbar-dark bg-dark new-color-navbar">
    <div class="container">
        <a class="navbar-brand" href="{% url 'home' %}"><i class="bi bi-shop"></i> N's Store</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav me-auto">
                <li class="nav-item">
                    <a class="nav-link active" href="{% url 'home' %}">Home</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link active" href="{% url 'docs' %}">Docs</a>
                </li>
            </ul>
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link" href="#"><i class="bi bi-cart3"></i> Cart <span class="badge bg-danger">3</span></a>
                </li>
                
                <!-- NOT LOGGED IN - Show Login/Register -->
                <li class="nav-item dropdown" id="nav-guest">
                    <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                        <i class="bi bi-person-circle"></i> Account
                    </a>
                    <ul class="dropdown-menu dropdown-menu-end">
                        <li><a class="dropdown-item" href="{% url 'login' %}"><i class="bi bi-box-arrow-in-right"></i> Login</a></li>
                        <li><a class="dropdown-item" href="{% url 'register' %}"><i class="bi bi-person-plus"></i> Register</a></li>
                    </ul>
                </li>
                
                <!-- LOGGED IN - Show User Name & Profile/Logout -->
                <li class="nav-item dropdown d-none" id="nav-user">
                    <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                        <i class="bi bi-person-circle"></i> Hi, <span id="user-name">User</span>
                    </a>
                    <ul class="dropdown-menu dropdown-menu-end">
                        <li><a class="dropdown-item" href="{% url 'profile' %}"><i class="bi bi-person"></i> Profile</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="#" onclick="logout(); return false;"><i class="bi bi-box-arrow-right"></i> Logout</a></li>
                    </ul>
                </li>
            </ul>
        </div>
    </div>
</nav>

<script>
// Check authentication status on page load
document.addEventListener('DOMContentLoaded', function() {
    checkAuth();
});

function checkAuth() {
    const token = localStorage.getItem('access_token');
    const userName = localStorage.getItem('user_name');
    
    const navGuest = document.getElementById('nav-guest');
    const navUser = document.getElementById('nav-user');
    const userNameSpan = document.getElementById('user-name');
    
    if (token && userName) {
        // User is logged in
        navGuest.classList.add('d-none');
        navUser.classList.remove('d-none');
        userNameSpan.textContent = userName;
    } else {
        // User is NOT logged in
        navGuest.classList.remove('d-none');
        navUser.classList.add('d-none');
    }
}

function logout() {
    // Clear localStorage
    localStorage.removeItem('access_token');
    localStorage.removeItem('refresh_token');
    localStorage.removeItem('user_name');
    localStorage.removeItem('user_email');
    
    // Redirect to home or login
    window.location.href = "{% url 'home' %}";
}
</script>